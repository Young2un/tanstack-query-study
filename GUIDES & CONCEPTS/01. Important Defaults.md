# Important Defaults

useQuery, useInfiniteQuery, useMutation, QueryClient ê°™ì€ í•¨ìˆ˜ë‚˜ í›…ì„ ì‚¬ìš©í•  ë•Œ,
ì˜µì…˜ì„ ë”°ë¡œ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ìžë™ìœ¼ë¡œ ì ìš©ë˜ëŠ” ê¸°ë³¸ ì„¤ì •ê°’

## staleTime â€“ ë°ì´í„°ë¥¼ staleë¡œ ê°„ì£¼í•˜ì§€ ì•ŠëŠ” ìœ íš¨ ì‹œê°„

TanStack QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `useQuery`ë¥¼ í†µí•´ ê°€ì ¸ì˜¨ **ìºì‹œëœ ë°ì´í„°ë¥¼ í•­ìƒ stale(ì˜¤ëž˜ë¨)** ìƒíƒœë¡œ ê°„ì£¼í•œë‹¤.

ë”°ë¼ì„œ ì»´í¬ë„ŒíŠ¸ê°€ **ìƒˆë¡œ ë§ˆìš´íŠ¸ë  ë•Œë§ˆë‹¤ ìžë™ìœ¼ë¡œ refetch**(ë°ì´í„° ìž¬ìš”ì²­)ê°€ ë°œìƒí•œë‹¤.

(â†’ `refetchOnMount: 'always'` ê¸°ë³¸ê°’ ë•Œë¬¸)

í•˜ì§€ë§Œ ë°ì´í„°ê°€ ë°”ë€Œì§€ ì•Šì•˜ëŠ”ë°ë„ ë§¤ë²ˆ refetchê°€ ì¼ì–´ë‚˜ë©´ **ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­**ì´ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.

ì´ëŸ´ ë•Œ `staleTime` ì˜µì…˜ì„ ì„¤ì •í•˜ë©´ ì¼ì • ì‹œê°„ ë™ì•ˆ ì¿¼ë¦¬ë¥¼ **fresh(ìµœì‹ )** ìƒíƒœë¡œ ìœ ì§€í•  ìˆ˜ ìžˆë‹¤.

```tsx
useQuery({
  queryKey: ["posts"],
  queryFn: fetchPosts,
  staleTime: 1000 * 60 * 5, // 5ë¶„ ë™ì•ˆì€ staleë¡œ ê°„ì£¼í•˜ì§€ ì•ŠìŒ
});
```

## refetch ì œì–´

ê¸°ë³¸ì ìœ¼ë¡œ TanStack QueryëŠ” ì¿¼ë¦¬ë¥¼ stale(ì˜¤ëž˜ëœ) ìƒíƒœë¡œ ê°„ì£¼í•˜ê¸° ë•Œë¬¸ì—

ì•„ëž˜ì™€ ê°™ì€ ìƒí™©ì—ì„œëŠ” **ìžë™ìœ¼ë¡œ refetch(ë‹¤ì‹œ ìš”ì²­)** ì´ ë°œìƒí•œë‹¤.

### ìžë™ refetchê°€ ë°œìƒí•˜ëŠ” ì‹œì 

- ì¿¼ë¦¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒˆë¡œ ë§ˆìš´íŠ¸ë  ë•Œ
- ì°½(Window)ì´ ë‹¤ì‹œ í¬ì»¤ìŠ¤ë  ë•Œ
- ë„¤íŠ¸ì›Œí¬ê°€ ë‹¤ì‹œ ì—°ê²°ë  ë•Œ
- `refetchInterval`ì´ ì„¤ì •ëœ ê²½ìš° (ì£¼ê¸°ì  ìš”ì²­)

### â‡’ ì´ê±´ ì„¸ë¶€ì ìœ¼ë¡œ ì œì–´ í•  ìˆ˜ ìžˆìŒ

```tsx
useQuery({
  queryKey: ["posts"],
  queryFn: fetchPosts,
  refetchOnWindowFocus: false, // ì°½ í¬ì»¤ìŠ¤ ì‹œ ìžë™ ìš”ì²­ ë¹„í™œì„±í™”
  refetchOnReconnect: false, // ë„¤íŠ¸ì›Œí¬ ìž¬ì—°ê²° ì‹œ ë¹„í™œì„±í™”
  refetchOnMount: false, // ë§ˆìš´íŠ¸ ì‹œ ìžë™ ìš”ì²­ ë°©ì§€
  refetchInterval: 1000 * 10, // 10ì´ˆë§ˆë‹¤ ìžë™ ìš”ì²­
});
```

ì´ ì˜µì…˜ì„ ë‚˜ì¤‘ì— ë– ì˜¬ë¦´ ìˆ˜ ìžˆê²Œ ì‹¤ë¬´ì—ì„œ ìžì£¼ ì‚¬ìš©í•˜ëŠ”ì§€ gptì—ê²Œ ì§ˆë¬¸

| ì˜µì…˜                   | ì‹¤ë¬´ì—ì„œ ì‚¬ìš© ë¹ˆë„       | ì™œ ì“°ëŠ”ì§€ / ì•ˆ ì“°ëŠ”ì§€                                                                                                                                            |
| ---------------------- | ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `refetchOnWindowFocus` | âœ… **ìžì£¼ ì‚¬ìš©í•¨**       | ìœ ì €ê°€ ì°½ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ì™”ì„ ë•Œ ìµœì‹  ë°ì´í„°ë¥¼ ë³´ìž¥í•˜ê³  ì‹¶ì„ ë•Œ ìœ ìš©í•¨. ì‹¤ì‹œê°„ì„± ìžˆëŠ” ë°ì´í„°ì— íŠ¹ížˆ ìœ ìš©í•¨ (ì˜ˆ: ì•Œë¦¼, ì‹¤ì‹œê°„ ëŒ“ê¸€ ë“±). í•˜ì§€ë§Œ ë¹„í™œì„±í™”í•  ì¼ë„ ë§ŽìŒ |
| `refetchOnReconnect`   | âœ… **ìžì£¼ ì‚¬ìš©í•¨**       | ë„¤íŠ¸ì›Œí¬ê°€ ëŠê²¼ë‹¤ ë‹¤ì‹œ ì—°ê²°ëì„ ë•Œ ìžë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ì‹¶ì€ ê²½ìš° ìœ ìš©í•¨. íŠ¹ížˆ ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì¤‘ìš”                                                    |
| `refetchOnMount`       | âœ…/âŒ **í•„ìš” ì‹œë§Œ ì‚¬ìš©** | ê¸°ë³¸ê°’ì€ `"always"`ì§€ë§Œ `"false"`ë¡œ ë‘ë©´ **ìºì‹œì— stale ë°ì´í„°ê°€ ìžˆë”ë¼ë„ refetchë¥¼ ë§‰ìŒ**. UX ìµœì í™” ìœ„í•´ ì“°ê¸°ë„ í•¨                                             |
| `refetchInterval`      | ðŸ”„ **ìƒí™© ë”°ë¼ ë‹¤ë¦„**    | ì‹¤ì‹œê°„ ë°ì´í„°ê°€ í•„ìš”í•œ ê²½ìš° (ì˜ˆ: ê±°ëž˜ì†Œ, ì±„íŒ… ë“±) ìœ ìš©í•˜ì§€ë§Œ, ê·¸ ì™¸ì—ëŠ” ìž˜ ì•ˆ ì”€. ì„œë²„ì— ë¶€ë‹´ì´ í¼                                                               |

> ðŸ‘‰ ë„ˆê°€ ì¼ë°˜ì ì¸ ì‚¬ìš©ìž ê²½í—˜ ìœ„ì£¼ë¡œ ê°œë°œí•œë‹¤ë©´ **`refetchOnWindowFocus:false`**,**`refetchOnReconnect: false`**ì •ë„ëŠ” ê¼­ ê³ ë ¤í•˜ê²Œ ë  ê±°ì•¼.

ë¼ëŠ” ë‹µë³€

## gcTime - ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ìž ì‹œ ìœ ì§€ë˜ëŠ” ì¿¼ë¦¬

`useQuery`, `useInfiniteQuery` ë“±ìœ¼ë¡œ ì‚¬ìš©ë˜ë˜ ì¿¼ë¦¬ëŠ” í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ê±°ë‚˜, ë” ì´ìƒ í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì—†ì„ ê²½ìš° **inactive(ë¹„í™œì„±) ìƒíƒœ**ë¡œ ì „í™˜ëœë‹¤.

ì¦‰, ì¿¼ë¦¬ê°€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©´ inactive ìƒíƒœê°€ ë¨ â†’ ê¸°ë³¸ì ìœ¼ë¡œ 5ë¶„ê°„ ìºì‹œì— ë‚¨ì•„ ìžˆë‹¤ê°€ ì‚­ì œ â†’ ì´ ì‹œê°„ì„ ì¡°ì ˆí•˜ëŠ” ì˜µì…˜ì´ `gcTime`

`gcTime` ë•ë¶„ì— ë™ì¼í•œ ì¿¼ë¦¬ê°€ ë‹¤ì‹œ ë§ˆìš´íŠ¸ë  ê²½ìš°, **ì¦‰ì‹œ ìºì‹œëœ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ê³  ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ìµœì†Œí™”**í•  ìˆ˜ ìžˆë‹¤.

```tsx
useQuery({
  queryKey: ["user"],
  queryFn: fetchUser,
  gcTime: 1000 * 60 * 10, // 10ë¶„ ë™ì•ˆ ìºì‹œì— ìœ ì§€ë¨ (ê¸°ë³¸ê°’ì€ 5ë¶„)
});
```

## retry - ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ ìžë™ ìž¬ì‹œë„

ì¿¼ë¦¬ê°€ ì‹¤íŒ¨í•˜ë©´ TanStack QueryëŠ” **UIì— ì—ëŸ¬ë¥¼ í‘œì‹œí•˜ê¸° ì „ì—**,

**ì§€ìˆ˜ì  ë°±ì˜¤í”„(exponential backoff) ë°©ì‹ìœ¼ë¡œ ìžë™ ìž¬ì‹œë„**ë¥¼ ì‹œë„í•œë‹¤.

- ê¸°ë³¸ì ìœ¼ë¡œ ìµœëŒ€ **3ë²ˆê¹Œì§€ ìž¬ì‹œë„** í•˜ë©°
- ìž¬ì‹œë„ ê°„ê²©ì€ ì ì  ê¸¸ì–´ì§€ëŠ” **ì§€ìˆ˜ ì¦ê°€ ë°©ì‹**ì´ë‹¤
  (ì˜ˆ: 1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ â€¦)

ì´ ë™ìž‘ì€ ë„¤íŠ¸ì›Œí¬ ì¼ì‹œ ì˜¤ë¥˜, ì„œë²„ ì§€ì—° ë“±ì—ì„œ **ì‚¬ìš©ìž ê²½í—˜ì„ ë¶€ë“œëŸ½ê²Œ ë§Œë“œëŠ” ë° ë„ì›€**ì´ ëœë‹¤.

ìž¬ì‹œë„ ë™ìž‘ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ë ¤ë©´ ì•„ëž˜ ì˜µì…˜ë“¤ì„ ì‚¬ìš©í•œë‹¤:

- `retry`: ìž¬ì‹œë„ íšŸìˆ˜
- `retryDelay`: ìž¬ì‹œë„ ê°„ê²© ì„¤ì • í•¨ìˆ˜

### ì˜ˆì‹œ

```tsx
useQuery({
  queryKey: ["user"],
  queryFn: fetchUser,
  retry: 2, // ìµœëŒ€ 2ë²ˆë§Œ ìž¬ì‹œë„
  retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 5000),
});
```

## structuralSharing â€“ êµ¬ì¡°ì  ê³µìœ 

TanStack QueryëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ, **ì´ì „ ë°ì´í„°ì™€ ìƒˆ ë°ì´í„°ê°€ êµ¬ì¡°ì ìœ¼ë¡œ ê°™ìœ¼ë©´ ì°¸ì¡°(reference)ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€**í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ë°©ì§€í•œë‹¤.

ì´ ê¸°ëŠ¥ ë•ë¶„ì— Reactì˜ `useMemo`, `useCallback`ê³¼ì˜ ì•ˆì •ì ì¸ ì—°ë™ì´ ê°€ëŠ¥í•˜ê³ , ì„±ëŠ¥ ìµœì í™”ì—ë„ ë„ì›€ì´ ëœë‹¤.

ðŸ“Œ ì´ ê¸°ëŠ¥ì€ **ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìžˆìœ¼ë©°**, **99.9%ì˜ ê²½ìš° ë¹„í™œì„±í™”í•  í•„ìš”ê°€ ì—†ë‹¤.**

### ì£¼ì˜í•  ì 

- êµ¬ì¡°ì  ê³µìœ ëŠ” **JSON í˜¸í™˜ ë°ì´í„°**ì—ì„œë§Œ ë™ìž‘í•¨
- í•¨ìˆ˜, Map, Set, í´ëž˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ë“±ì€ í•­ìƒ ë°”ë€ ê²ƒìœ¼ë¡œ ê°„ì£¼ë¨
- ë„ˆë¬´ í° ì‘ë‹µ ë°ì´í„°ì—ì„œ ì„±ëŠ¥ ì´ìŠˆê°€ ìžˆë‹¤ë©´ ë¹„í™œì„±í™” ê³ ë ¤ ê°€ëŠ¥

```tsx
useQuery({
  queryKey: ["posts"],
  queryFn: fetchPosts,
  structuralSharing: false, // ë¦¬ë Œë”ë¥¼ ê°•ì œë¡œ ì¼ìœ¼í‚¬ ìˆ˜ ìžˆìŒ
});

// ë˜ëŠ” ì»¤ìŠ¤í…€ ë¹„êµ í•¨ìˆ˜ ì‚¬ìš©
structuralSharing: (prev, next) => (_.isEqual(prev, next) ? prev : next);
```
